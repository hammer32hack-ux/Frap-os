name: frap os

on:
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä—É—á–Ω—É—é
  push:
    branches: [ main ]

jobs:
  build-custom-iso:
    runs-on: ubuntu-latest
    
    steps:
    - name: üöÄ start frap os 
      run: |
        echo "=== –£–°–¢–ê–ù–û–í–ö–ê –ò–ù–°–¢–†–£–ú–ï–ù–¢–û–í ==="
        sudo apt-get update
        sudo apt-get install -y \
          genisoimage \
          syslinux \
          isolinux \
          xorriso \
          wget \
          curl \
          squashfs-tools \
          mtools
        
        echo "=== –°–ö–ê–ß–ò–í–ê–ï–ú –ë–ê–ó–û–í–£–Æ –°–ò–°–¢–ï–ú–£ ==="
        # Tiny Core Linux - –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏–π (16MB)
        wget -q --show-progress http://tinycorelinux.net/13.x/x86_64/release/TinyCorePure64-13.0.iso
        
        echo "=== –°–û–ó–î–ê–Å–ú –°–¢–†–£–ö–¢–£–†–£ ==="
        mkdir -p /tmp/mountpoint /tmp/custom-iso
        
        echo "=== –ú–û–ù–¢–ò–†–£–ï–ú –ò –ö–û–ü–ò–†–£–ï–ú ==="
        sudo mount -o loop TinyCorePure64-13.0.iso /tmp/mountpoint
        cp -r /tmp/mountpoint/* /tmp/custom-iso/ || true
        sudo umount /tmp/mountpoint
        
        echo "=== –î–û–ë–ê–í–õ–Ø–ï–ú –ù–ê–®–ò –§–ê–ô–õ–´ ==="
        # –°–æ–∑–¥–∞—ë–º —Å–≤–æ–π –∫–æ–Ω—Ñ–∏–≥ –∑–∞–≥—Ä—É–∑–∫–∏
        cat > /tmp/custom-iso/boot/isolinux/isolinux.cfg << 'EOF'
DEFAULT custom-os
LABEL custom-os
  MENU LABEL My Custom OS
  KERNEL /boot/vmlinuz64
  APPEND initrd=/boot/corepure64.gz quiet
EOF
        
        # –î–æ–±–∞–≤–ª—è–µ–º README
        echo "# –ú–æ—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –û–°" > /tmp/custom-iso/README.md
        echo "–°–æ–±—Ä–∞–Ω–æ: $(date)" >> /tmp/custom-iso/README.md
        echo "–ê–≤—Ç–æ—Ä: ${{ github.actor }}" >> /tmp/custom-iso/README.md
        
        echo "=== –°–û–ë–ò–†–ê–ï–ú –ù–û–í–´–ô ISO ==="
        xorriso -as mkisofs \
          -o /tmp/my-custom-os.iso \
          -isohybrid-mbr /usr/lib/syslinux/mbr/isohdpfx.bin \
          -c isolinux/boot.cat \
          -b isolinux/isolinux.bin \
          -no-emul-boot -boot-load-size 4 -boot-info-table \
          -eltorito-alt-boot \
          -e boot/grub/efi.img \
          -no-emul-boot \
          -isohybrid-gpt-basdat \
          -V "MY_CUSTOM_OS" \
          /tmp/custom-iso
        
        echo "=== –ü–†–û–í–ï–†–Ø–ï–ú –†–ê–ó–ú–ï–† ==="
        ls -lh /tmp/my-custom-os.iso
        
    - name: üì¶ Upload ISO as Artifact
      uses: actions/upload-artifact@v4
      with:
        name: custom-os-iso
        path: /tmp/my-custom-os.iso
        retention-days: 7
        
    - name: üåê Generate Direct Download Link
      run: |
        # –°–æ–∑–¥–∞—ë–º –ø—Ä—è–º—É—é —Å—Å—ã–ª–∫—É (—á–µ—Ä–µ–∑ GitHub Pages)
        echo "ISO –≥–æ—Ç–æ–≤! –°–∫–∞—á–∞—Ç—å –º–æ–∂–Ω–æ:"
        echo "1. –í–æ –≤–∫–ª–∞–¥–∫–µ 'Artifacts' —ç—Ç–æ–≥–æ workflow"
        echo "2. –ò–ª–∏ –ø–æ –ø—Ä—è–º–æ–π —Å—Å—ã–ª–∫–µ –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è"
